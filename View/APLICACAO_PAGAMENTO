CREATE VIEW APLICACAO_PAGAMENTO AS
SELECT A.afp_no N_APLICACAO,
       A.contract_no CONTRATO,
       IFSGFT.SALES_CONTRACT_API.Get_Contract_Name(A.CONTRACT_NO) NOME_CONTRATO,
       A.COMPANY EMPRESA,
       IFSGFT.SALES_CONTRACT_API.Get_Site(A.CONTRACT_NO) SITE,
       STATE STATUS,
       A.CUST_CERT_NO CERTIFICADO_CLIENTE,
       A.CUSTOMER_ID ID_CLIENTE,
       IFSGFT.CUSTOMER_INFO_API.Get_Name(A.CUSTOMER_ID) NOME_CLIENTE,
       A.VALUATION_NO N_AVALIACAO,
       A.APPLICATION_DATE DT_APLICACAO,
       A.INVOICE_STATUS STATUS_TITULO,
       A.C_ORDER_NO N_ORDEM,
       A.C_ADDRESS_ID ID_ENDERECO,
       A.C_OPERATION_ID ID_OPERACAO,
       A.CURRENCY_CODE COD_MOEDA,
       A.PROJECT_ID ID_PROJETO,
       IFSGFT.PROJECT_API.Get_Name(A.PROJECT_ID) NOME_PROJETO,
       C.SUB_PROJECT_ID ID_SUBPROJETO,
       IFSGFT.SUB_PROJECT_API.Get_Description(C.PROJECT_ID,C.SUB_PROJECT_ID) DESC_SUBPROJETO,
       A.BILLING_SEQ SEQ_FATURAMENTO,
       A.SUPPLY_COUNTRY PAIS_FORNEC,
       A.C_INSTALLMENT_ID ID_PARCELA,
       A.C_ORDER_ID TIPO_ORDEM,
       B.LINE_NO N_LINHA,
       B.LINE_NAME NOME_LINHA,
       B.LINE_DESCRIPTION DESC_LINHA,
       IFSGFT.AFP_LINE_API.GET_LINE_WORK_VALUE(B.CONTRACT_NO, B.AFP_NO, B.LINE_NO) VAL_SERVICO,
       IFSGFT.AFP_LINE_API.GET_LINE_SM_VALUE(B.CONTRACT_NO, B.AFP_NO, B.LINE_NO) VAL_MATER_ARMAZ,
       IFSGFT.AFP_LINE_API.GET_LINE_TOTAL_VALUE(B.CONTRACT_NO, B.AFP_NO, B.LINE_NO) VAL_TOTAL_LINHA,
       IFSGFT.AFP_LINE_API.GET_LINE_CONTRACT_VALUE(B.CONTRACT_NO, B.AFP_NO, B.LINE_NO) VAL_CONTRATO_LINHA,
       IFSGFT.AFP_LINE_API.GET_LINE_WORK_CERTIFIED(B.CONTRACT_NO, B.AFP_NO, B.LINE_NO) SERVICO_CERTIFICADO,
       IFSGFT.AFP_LINE_API.GET_LINE_SM_CERTIFIED(B.CONTRACT_NO, B.AFP_NO, B.LINE_NO) MATER_ARMAZ_CERTIF,
       IFSGFT.AFP_LINE_API.GET_LINE_TOTAL_CERTIFIED(B.CONTRACT_NO, B.AFP_NO, B.LINE_NO) TOTAL_CERTIFICADO,
       C.ITEM_NO N_ITEM,
       C.ITEM_NAME NOME_ITEM,
       C.ITEM_DESCRIPTION DESC_ITEM,
       C.VALUATION_METHOD MTDO_AVALIACAO,
       C.VALUATION_VALUE VAL_AVALIACAO,
       IFSGFT.AFP_ITEM_API.Get_Prev_Valuation_Value(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VAL_AVALIA_ANTER,
       C.VALUATION_SM MATE_ARMAZEN_AVAL,
       IFSGFT.AFP_ITEM_API.Get_Prev_Sm_Value(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VAL_MATE_ARMA_ANTERI,
       AFP_ITEM_API.Get_Prev_Work_Value(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VAL_SERVICO_ANTERIOR,
       C.TOTAL_VALUATION VAL_TOTAL_ITEM,
       C.VALUATION_QUANTITY QTD_AVALIACAO,
       C.PROGRESS PROGRESSO,
       C.CERTIFIED_WORK SERVIC_CERTIFIC,
       C.CERTIFIED_QUANTITY QTD_CERTIFICADA,
       IFSGFT.AFP_ITEM_API.Get_Tot_Ret_App(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) TOTAL_RETEN_APLICAD_PARA,
       IFSGFT.AFP_ITEM_MAX_RET_API.Get_Tot_Ret_Cert(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) TOTEL_RETEN_CERTIFICADA,
       C.RETENTION_OVERRIDE SUBST_CERTIFICA_RETENC_TOTAL,
       IFSGFT.AFP_ITEM_API.Get_Ret_Released_App(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) RETEN_LIBER_APLICAD_PARA,
       IFSGFT.AFP_ITEM_API.Get_Ret_Released_Cert(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) RETEN_LIBER_CERTIFICADA,
       IFSGFT.AFP_ITEM_API.Get_Discount_App(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) DESCONTO_APLICACAO,
       IFSGFT.AFP_ITEM_API.Get_Discount_Cert(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) DESCONTO_CERTIFICADO,
       IFSGFT.AFP_ITEM_API.Get_Deduction_App(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) DEDUCAO_APLICACAO,
       IFSGFT.AFP_ITEM_API.Get_Deduction_Cert(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) DEDUCAO_CERTIFICADA,
       IFSGFT.AFP_ITEM_API.Get_Net_Valuation_App(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VAL_LIQ_APLICACAO,
       IFSGFT.AFP_ITEM_API.Get_Net_Valuation_Cert(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VAL_LIQ_CERTIFICADO,
       IFSGFT.AFP_ITEM_API.Get_This_Net_Value(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VAL_LIQ_DESSA_APLICA,
       IFSGFT.AFP_ITEM_API.Get_This_Tax_Amount(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VAL_IMPOST_DESSA_APLICA,
       IFSGFT.AFP_ITEM_API.Get_This_Gross_Value(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VAL_BRUTO_DESSA_APLICA,
       C.COST_VALUE VAL_CUSTO_MOED_EMPRE,
       C.SALES_VALUE VAL_VENDA,
       C.CONTRACT_DISCOUNT DESCONT_CONTRATO,
       C.CONTRACT_INT_RET RETENCAO_TOTAL,
       C.CONTRACT_FIN_RET RETENC_FINAL_CONTRAT,
       IFSGFT.AFP_ITEM_API.Get_Variance_Work(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VARIACAO_SERVICO,
       IFSGFT.AFP_ITEM_API.Get_Variance_Sm(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) VARIAC_MAT_ARMAZ,
       C.VALUED_COST CUSTO_ESTIMADO,
       C.ACTIVITY_SEQ ATIVIDADE_RECEITA,
       IFSGFT.ACTIVITY_API.Get_Description(C.ACTIVITY_SEQ) DESC_ATIV_RENDIM,
       IFSGFT.Afp_Project_Cost_API.Get_Project_Cost(C.CONTRACT_NO, C.AFP_NO, C.LINE_NO, C.ITEM_NO) CUSTO_PROJETO,
       C.PROJECT_PROGRESS PROGRESSO_PROJETO,
       C.PROJECT_COST_DATE DT_CUSTO_PROJETO,
       C.NOTES NOTAS,
       C.CALCULATION_METHOD MTDO_CALCULO,
       C.VALUATION_TYPE TIP_CALCULO,
       C.COST_RATE_FACTOR FATOR_TX_CUSTO,
       C.COST_RATE TX_CUSTO,
       C.UNIT_OF_MEASURE UNIDADE,
       C.CONTRACT_QUANTITY QTDE_CONTRATO,
       C.CONTRACT_ITEM_STATUS STATUS_ITEM_CONTRAT,
       C.ITEM_CODE COD_REF_ITEM,
       C.ITEM_DATE DT_ITEM,
       C.SALES_GROUP GRP_VENDAS,
       C.SALES_RATE TX_VENDAS,
       C.SALES_PART_SITE SITE_MATER_VENDA,
       C.CATALOG_NO MAT_VENDAS,
       C.MARKUP REMARCACAO,
       C.IN_QUERY NA_CONSULTA,
       C.ITEM_REPORT_CODE COD_RELA_ITEM,
       IFSGFT.REPORT_COST_API.Get_Description(C.COMPANY,C.ITEM_REPORT_CODE, C.ITEM_DATE) DESC_COD_RELATORIO,
       IFSGFT.REPORT_COST_API.Get_Delivery_Type(C.COMPANY,C.ITEM_REPORT_CODE,C.ITEM_DATE) TIPO_ENTREGA,
       IFSGFT.REPORT_COST_API.Get_Delivery_Type_Description(C.COMPANY,C.ITEM_REPORT_CODE,C.ITEM_DATE) DESC_TIPO_ENTREGA,
       IFSGFT.Source_Tax_Item_API.Multiple_Tax_Items_Exist(C.company,'SALES_CONTRACT_AFP_ITEM',C.contract_no,TO_CHAR(C.afp_no),TO_CHAR(C.line_no),TO_CHAR(C.item_no), '*') LINHA_IMPOS_EXISTEM,
       C.TAX_CALC_STRUCTURE_ID ESTRUT_CALC_FISCAL,
       IFSGFT.Source_Tax_Item_API.Get_Line_Tax_Code(C.COMPANY, 'SALES_CONTRACT_AFP_ITEM', C.CONTRACT_NO, TO_CHAR(C.AFP_NO), TO_CHAR(C.LINE_NO), TO_CHAR(C.ITEM_NO), '*') COD_IMPOSTO,
       IFSGFT.STATUTORY_FEE_API.Get_Description(C.COMPANY, IFSGFT.Source_Tax_Item_API.Get_Line_Tax_Code(C.COMPANY, 'SALES_CONTRACT_AFP_ITEM', C.CONTRACT_NO, TO_CHAR(C.AFP_NO), TO_CHAR(C.LINE_NO), TO_CHAR(C.ITEM_NO), '*')) DESC_COD_IMPOSTO,
       C.CHANGE_OBJECT_SEQUENCE SEQ_ORDE_ALTERA_CONTRATO,
       IFSGFT.Afp_Item_API.Get_Contract_Change_Order_Id(C.CONTRACT_NO,C.AFP_NO,C.LINE_NO,C.ITEM_NO) N_ORDE_ALTER_CONTRATO,
       IFSGFT.Afp_Item_API.Get_Change_Object_Name__(C.CHANGE_OBJECT_SEQUENCE) NOME_ORDE_ALTER_CONTRAT,
       C.CHANGE_COMMENT COMENT_ALTERACAO,
       C.ITEM_TYPE TIPO_ITEM
  FROM APP_FOR_PAYMENT_MAIN A
  JOIN IFSGFT.AFP_LINE B             ON A.CONTRACT_NO = B.CONTRACT_NO AND A.AFP_NO = B.AFP_NO
  JOIN IFSGFT.AFP_ITEM C             ON B.CONTRACT_NO = C.CONTRACT_NO AND B.AFP_NO = C.AFP_NO AND B.LINE_NO = C.LINE_NO     
